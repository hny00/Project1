안녕하세요 저희는 감소 고객의 행동 패턴을 분석 후 
그에 맞는 맞춤형 서비스를 제공하고자 합니다.  저는 아이디어메이커스의 팀장이자 발표자 김동완입니다. 

2. 목차 
-> 
저희가 감소고객을 주제를 선정하게된 과정을 보여드리고 
감소고객의 패턴을 파악하기 위해 사용한 데이터와 그 데이터를 정리하는 과정을 보여드리고 
머신러닝을 활용하여 데이터 학습 후 유형 파악을 위한 군집화 과정을 보여드리고 
각 유형에 따른 마케팅 제언과 결론으로 개선점에 대해서 말씀드리겠습니다. 

3. 개요입니다. 

4. 팀설명 
아이디어메이커스는 김동완, 김성호, 한나영, 윤예은, 손아로 이루어져 있고 저희 팀원은 
피쳐 전처리, 데이터 분석, 시각화에 대한 작업을 진행하였습니다.  

5. 수행절차 
개발시간 32일동안 사전기획, 데이터 수집, 전처리, 모델링, 군집분석을 하였습니다. 

6. 기업은 고객과 상호작용하기 위해서 노력한다. 

7. 기업은 고객을 더 잘 이해하고 이에 맞는 상품을 제공하기 위해서 노력하고 있습니다. 
-> 저희는 많은 기업이 고객의 패턴을 이해하고 유의사항을 통한 
전략을 설정하기를 원함을 알수 있었습니다. 

8. 저희가 분석 할 데이터는 2014~2015년 데이터이므로
 이 당시 상황에 대해서 간략히 말씀드리겠습니다. 국제적으로
2014~2015년은 원유공급량 증가에 따른 원유가격이 하락하였고 

9. 국내에서는 사치품에 대한 과세 감소, 하지만 소비세율은 증가하였습니다. 

10. 저희가 분석할 회사의 내부 사항은 2014년 대비 2015년 감소 인원은 전체 44%이고 
이들의 매출 감소량은 전체 16%에 해당합니다. 

11. 분기별로 파악 결과 각 분기 별 약50%정도 감소 인원이 존재하였습니다. 

12. 감소 인원의 14-1분기 대비 15-4분기 총 감소액은 약 280억원 정도이고 
이들을 제외한 인원들의 성장률은
이들을 포함한 성장률 보다 7.5%정도 높았습니다.
-> 그래서 저희는 감소 인원의 대한 조사의 필요성을 느꼈습니다. 

13. 데이터 소개입니다. 

14. 내부의 상품코드는 A,B,C,D 제휴사는 각각 9,92,17,8개의 대분류코드를 가지고 있고 각 대분류 코드당  
다음과 같은 중분류코드와 소분류코드를 가지고 있습니다. 
총 대분류코드는 126개, 중분류코드는 807개, 소분류코드는 4386개 입니다.

15. 각 제휴사는 상이한 중분류코드를 가지고 있어서 유통물류진흥원에서 만든 
분류기준 KAN상품분류코드에 따라서
카테고리 통합하였습니다. 

16. 각 상품의 가격차이에 따른 분류를 위해 10만원 기준으로 
일상품, 선매품, 사치품으로 나누었습니다. 
각 카테고리의 가격차이에 따른 분류를 위해 
카테고리 평균기준으로 저가,중가,고가로 나누었습니다. 

17. 고객데이터는 고객코드에 따른 19383명이 존재하고 
이들의 성별,거주지역, 연령대 정보가 있고 
구매시간, 멤버십 유무가 있습니다.

18. 저희는  고객의 연령대를 나이에 따라 학생, 
MZ,X,베이비부머 구매 시간대에 따른 심야,아침,낮,저녁으로 나누고
거주지역 번호에 따라 41개 지역을 17개 지역으로 범주화 하였습니다. 

19. 기타데이터에는 경쟁사 이용 년월, 구매에 사용한 채널이 있습니다. (덜중요)

20. 정리하자면 저희는 원본데이터를 다음과 같이 축소하였습니다. 

21. 저희는 14-1분기 부터 15-4분기 까지 구매가 한번도 끊기지 않은 고객을 기준고객, 한번이라도 끊긴 고객을 이탈고객
으로 나누었습니다. 기준고객은 전체고객 대비 인원수가 97.3%로 차지하고 기준고객의 매출은 총매출에 98.7%에 해당합니다. 
저희는 이들을 분석 조사하였습니다. 

22. 저희는 구매감소에 계절성 변수를 제거하고자 계절성 제거 공식을 이용하여 구매금액을 정리한 후 CAGR공식을 
이용하여 지수를 구했습니다. 저희는 또한 물가 영향 변수를 제거하고자 계절성 제거 CAGR지수 보다 낮은 고객을 
감소고객이라 지정하였습니다. (자세하게 설명)

23. 저희는 감소고객의 구매 패턴을 파악 후 유형화 하여 유형에 따른 해결책을 제시하는것을 과제로 정의 하였습니다. 

24. 저희는 고객의 구매 흐름을 지수를 얻기 위해서 각 분기 구매금액에 따른 등급화 후 처음과 끝의 차이를 보여주는
순등급 등급이 얼마나 움직였는지에 따른 변동율을 설정하였습니다. 
예시로 고객이 2 -> 4 ->3등급이 되면 최종적으로  2에서 3으로 1등급이 떨어졌으므로 순등급은  -1 그리고 
-2,1로 변했으므로 변동율은 절댓값의 합인 3입니다.

25. 고객이 어떤 상품을 주로 사는지 알기 위해서 각분기당 고객이 구입한 카테고리 별 비중과 빈도수를 구했습니다. 

26. 총 정리하면 고객의 속성정보는 5개 고객의 구매패턴에 따른 변수는 121개로 총 126개의 피쳐로 지정하였고 
감소고객을 1, 아니면 0으로 하여 라벨을 지정하였습니다. 

27. 해당 데이터를 가지고 머신러닝 수행 절차에 대해서 말씀드리겠습니다.

28. 저희가 가진 데이터는 14년 ~ 15년 데이터로 1년간의 구매패턴을 활용하여 다음 분기를 예측하는 모델을
만들고자 하였습니다. 따라서 14-1분기 ~ 15-1분기 구매패턴을 피쳐로 15-2분기를 타겟으로 하는 학습데이터를 
이를 기반으로 학습 시킨 모델을 14-2 ~ 15-2를 기반으로 15-3을 예측하는 벨류셋, 14-3분기 ~ 15-3분기를 기반으로 
예측하는 테스트 셋을 검증하고자 합니다.  다시말씀드리면 테스트셋은 훈련용으로 벨류셋,테스트셋은 검증용으로 사용하였습니다.
-> 맞습니다 겹치는 부분을 사용하게 되어서 과적합에 문제가 생길수 있습니다. 따라서 벨류셋, 테스트셋은훈련에
 따로 나누어서 또 과적합을 최소화하고자 하였습니다. 


29. 저희는 테스트 셋에 널값을 처리하고 고객번호를 삭제하는 전처리 과정을 가졌습니다. 
(질문: 널값을 어떻게 처리했나요?
1. 너무 많은 널값의 경우는 삭제처리, 2. 적절한 널값의 경우는 피쳐의 유형, 등에 따라 변형처리 하였습니다.) 

30. 저희는 거주지역과 같이 변수가 많은 문자열에 대해서 원핫 인코딩 처리하였고 변수가 비교적 적은 성별에 관해서는 라벨인코딩 처리하여 
피쳐의 갯수는 적게 분석의 오차는 최소화 하였습니다. 
(굳이 원핫 인코딩으로 처리한 이유가 무엇인가요? 조금의 변수도 주고 싶지 않았고 각각 유형에 
대한 그림을 자세하게 보고 싶었습니다. 

31. 처리 과정을 통해 144개의 피쳐를 가지게 되었고 학습을 통해 구한 피쳐중요도, 랜덤한 변수 조합,
통계자료 활용을 통해 피쳐간소화를 진행하였습니다. 

32. 피쳐 간소화를 통해 34개로 간소화 할 수 있었습니다. 

33. 저희는 로지스틱, 디시젼트리, 랜덤포레스트, 그래디언부스트, xgboost, lightGBM, 서포트벡터머신,보팅방식을 활용하여
해당 피쳐를 학습하였고 정확성, ROC_AUC스코어가 높은 모델 로지스틱, 랜덤포레스트, XGBOOST, LIGHTGBM
을 선택하였고 이들을 그리드서치, 하이퍼오피티를 활용하여 다음과 같은 하이퍼파라미터를 조정하여 학습하였습니다. 

34. 저희는 테스트셋을 이용하여 예측한 결과 각 모델별 로지스틱은 정밀도,
 랜덤포레스트는 재현율 ,ROC_AUC는 XGBOOST가 우수하였습니다. 

35. 비교적 우수한 성능을 보인 로지스틱, XGBOOST, 랜덤포레스트의 회귀계수, 피쳐 중요도를 파악 결과 전체 순등급,
구매 빈도수증가, 선호 물품 순등급, 선매품 순등급 등이 중요 변수 였습니다. 

36. 군집화 수행절차 입니다. 

37. 저희는 감소고객의 특징을 파악하기 위해서 군집화를 진행하였습니다. (한템포 쉬고) 저희는 14-1분기 -> 15-1분기
기준에 감소한 감소고객을 (한템포 쉬고) 감소고객예측에 사용한 피쳐 34개를 이용하여 군집화 하였습니다. 

38. 군집의 갯수를 파악하기 위해 PCA를 활용하여 차원 축소 후 데이터의 밀집도를 통해 KMeans를 사용하고자 하였고
KMeans에 실루엣 점수 총합을 바탕으로 4개로 군집화 하였을때가 가장 적절하다는 것을 알수있었습니다. 

39. 이에 대한 시각화 그래프로 (한템포 쉬고) 실제로도 4개로 군집화 하였을때 가장 적절한 그림을 얻을수 있음을 알 수 있었습니다.

40. 저희는 PCA의 고유벡터를 통해 변동율, 빈도수가 중요한 변수라는 것을 확인 할 수 있었습니다. 확인 결과 
빈도수가의증가폭이 큰 고객은 변동율이 컸고 빈도수의 증감폭이 작은 군집의 경우 변동율 또한 작다는 것을 알 수있었습니다. 
다시 말씀드리면 (손짓으로 설명하며) 구매빈도가 크게 증가하거나 감소하는 경우 그 구매 패턴의 변동 또한 크고 작은 경우 
변동 또한 미미 하였습니다. (자세하게 설명) 

(숫자 정리하기)
41. (잘 생각하면서 이야기 하기)
저희는 일상용품, 전문스포츠, 사치품, 선매품, 일상품에 대한 따로 조사하여 4개의 군집을 얻었습니다. 
(손짓으로 설명) 유의 할 점은 구매 빈도가 크게 증가하더라도 변동율이 높은 불안한 고객은 감소유형에 속하였고 
구매빈도가 적게 감소하더라도 꾸준히 감소하는 고객 또한 감소 유형에 속하였습니다. 
이 군집에는 하나의 문제가 있는데 구매 빈도수와 일상용품, 전문스포츠의 구매 빈도수가 반비례관계라는 것입니다. 
다시 말해서 구매 빈도가 감소하더라도 일상용품, 전문스포츠의 구매 빈도는 증가하여 감소고객을 정의하는게
어렵다는 것입니다.(심각하게 말하기) 따라서 
저희는 34개의 피쳐중 군집화에 큰 영향을 준 피쳐를 기준으로 재 군집화해야 한다는 것입니다. 

42. (잘 생각하면서 이야기 하기)
앞서 군집화의 중요한 영향을 준 11개의 피쳐(한템포 쉬고)와 추가로 
선호물품 자체가 얼마나 변하는지를 알려주는 우선순위 변동율, (한템포 쉬고) 
고객의 1년 총매출에 따른 등급을 피쳐로 추가하여 13개의 피쳐를 활용하여 재군집화 하였습니다.
군집화 과정은 앞과 동일하고 3개로 군집화 하기로 결정하였습니다. (자세한 설명)

43. 고객이 1년 동안 자신의 선호물품을 얼마나 꾸준히 구매했는가를 지수화 한 변동율을 (손으로 설명)
기준으로 조사한 결과 변동율 중간, 낮음, 높음으로 나눌수 있었습니다. 

44. 고객이 1년 동안 자신의 선호물품을 얼마나 바꾸었는지를 수치화한 변화율 기준으로 조사한 결과 (손으로 설명)
변동율 중간, 낮음, 높음으로 나눌수 있었습니다. 

45. 고객이 1년 동안 해당회사를 얼마나 이용했는가를 수치화한 빈도수를  기준으로 
조사한 결과 1번을 제외하고 하락하였습니다. 

46. 저희는 X축을 변동율, Y축을 빈도수라고 하였을때 3개의 군집을 나눌 수 있었습니다. 

47. 각 군집에 대한 마케팅 제언입니다. 

48. 앞서 구한 3개의 군집을 저희는 편의상 낮은변동, 중간변동, 높은변동으로 군집을 정의하겠습니다. 

49. 낮은 변동의 경우 식품위주를 주로 사며 고가의 비중이 낮았습니다.  

50. 중간 변동의 경우 다른 군집에 비해 상품이 고루 분포되어있고 다른 군집에 비해 구매액이 높았습니다. 

51. 높은 변동의 경우 의류의 비중이 높았습니다. 

52. 낮은 변동은 식품과 저가위주로 구입하였고, 중간변동은 여러상품을 고루샀으며 높은 변동은 
의류를 주로 사는 군집 이었습니다. (천천히 설명 + 손짓으로 설명)

53. 저희는 아이템기반최근접이웃과 서프라이즈 모듈을 활용하여 이들에게 상품을 추천하고자 합니다. (한템포 쉬고)
저가, 식품 위주로 사는 낮은 변동의 경우 이에 맞게 비교적 저렴하며 많은 고객이 구입한 상품을 추천하고자 하였습니다.
(천천히 설명 + 손짓으로 설명)

54. 저희는 여러개의 상품을 사며 다양한의 취향이 있는 중간변동 고객에게는 각각의 고객의 취향에 맞는 상품을 추천하면서 
비슷한 취향을 가진 다른 고객이 주로 주로 구매한 상품도 함께 추천하였습니다. (천천히 설명 + 손짓으로 설명)

55. 의류 위주의 구매를 가진 높은 변동을 가진 고객에게는 각 트렌드에 맞는 상품을 추천하였습니다. 

56. 종합 하면 저희가 추천한 상품에 사용한 서프라이즈의 SVD를 활용한 모델의 MLSE지수는 0.5426이었고 
이 고객이 추천 상품을 구입시 예상 매출액이 약 30억 정도 예상되었습니다. (천천히 설명) 

57. 저희가 조사한 패턴을 더욱 개선할 점에 대해서 말씀드리겠습니다. 

58. 대분류 카테고리 분석 시 상품의 속성정보를 무시하게되는 문제점을 파악하였습니다. 

59. 실제 저희가 감소고객을 군집화 한 4개의 군집의 연령대, 성별의 비율을 조사한 결과 모두 비슷하였습니다.

60. 저희는 대분류 카테고리보다 중분류를 기준으로 분석한다면 속성변수또한 추가하여 군집화 할 수 있을거라는 
희망이 있었습니다. (한템포 쉬고)
그래서 조사한 결과 같은 음료라도 탄산은 비교적 낮은 연령대 전통차는 높은 연령대 처럼 나눌수 있었습니다.

61. 저희는 실제로 중분류별로 상품의 이용여부에 따라서 피쳐화 하여 시도하였습니다. (희망찬 목소리로)

62. 하지만 너무 많은 데이터와 상이한 분류코드는 분석에 아주 큰어려움을 주어서 이를 사용할 수 없었습니다. (시무룩)

63. CRM시스템을 구성할 때 고객의 경쟁사 이용, 멤버십유무는 사용되는 데이터 입니다. 그래서 이를 이용한 분석을 
하고자 하였습니다. 

64. 실제 저희는 경쟁사이용년월의 여부, 빈도수를 기준으로 피쳐화 하였습니다. 

65. 멤버십은 가입유무 가입수에 따라서 피쳐화를 진행하였습니다. 허나 멤버십 이용여부는 전체 19383명 기준 
6498개의 데이터뿐이였고 이마저도 14~15년 이전인 과거 데이터가 2166개였습니다. 
경쟁사 이용여부는 매출의 부재, 모호한 표기로 인해서 사용할 수 없었습니다. 

66. 정리하겠습니다. 저희는 데이터를 추출 -> 지수화 -> 분석 -> 피쳐화-> 머신러닝 활용의 과정을 거쳤습니다. 
이를 통해 34개의 피쳐를 활용한 고객감소 예측 모델을 생성하였습니다.
그리고 감소고객을 군집화와 재군집화를 통해 유형화 하여 변동적음, 중간, 많음으로 유형화 하였습니다. 
각각의 군집을 분석하여 그에 맞는 전략을 설정하고 실시한 후 피드백을 하여 유형에 따른 상품 추천 및 
보안할 점을 설정하였습니다. 

67.  저희는 데이터베이스로 오라클을 사용하고 언어는 파이썬을 활용하였습니다. 데이터 분석에 넘파이 판다스
시각화에 맷플로립, 시본이 사용되었습니다. 개발환경에는 코랩, 주피터노트북이 사용되었고 머신러닝은 사이킷런,
함께 라이트GBM, XG부스트가 활용되었습니다. 그외에 코드를 공유, 파일 공유에 깃허브, 상품추천에 서프라이즈 모듈
통계분석에 사이파이가 사용되었습니다. 

68. 저희 팀원의 느낀점 입니다. 
 
교차 검증을 하지 못한 이유 우선 교차검증을 하기 위해서는 테스트, 트레인셋을 모두 합친후 교차검증을 진행할수도 
있었겠으나 우선 군집화도 그렇고 고객의 1년간의 묶음을 중심으로 















  




